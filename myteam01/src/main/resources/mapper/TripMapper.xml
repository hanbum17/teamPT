<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.teamproject.myteam01.mapper.TripMapper">

    <!-- 여행 계획 저장 -->
    <insert id="insertTripPlan" parameterType="com.teamproject.myteam01.domain.TripPlanVO">
        INSERT INTO trip_plans (trip_no, user_id, title, start_date, end_date)
        VALUES (trip_seq.NEXTVAL, #{userId}, #{title}, #{startDate}, #{endDate})
    </insert>

    <!-- 사용자 ID로 여행 계획 목록 조회 -->
    <select id="selectTripPlansByUserId" resultType="com.teamproject.myteam01.domain.TripPlanVO">
        SELECT trip_no, user_id, title, start_date, end_date
        FROM trip_plans
        WHERE user_id = #{userId}
    </select>

    <!-- 특정 여행 계획 조회 -->
    <select id="selectTripPlan" resultType="com.teamproject.myteam01.domain.TripPlanVO">
        SELECT trip_no, user_id, title, start_date, end_date
        FROM trip_plans
        WHERE trip_no = #{tripNo}
    </select>

    <!-- 여행 계획에 속한 장소 목록 조회 -->
    <select id="selectTripPlacesByTripNo" resultType="com.teamproject.myteam01.domain.TripPlaceVO">
        SELECT id, trip_no, place_name, address, order_num, start_date
        FROM trip_places
        WHERE trip_no = #{tripNo}
        ORDER BY order_num ASC
    </select>

    <!-- 장소 추가 -->
    <insert id="insertPlace" parameterType="com.teamproject.myteam01.domain.TripPlaceVO">
        INSERT INTO trip_places (id, trip_no, place_name, address, order_num, start_date)
        VALUES (place_seq.NEXTVAL, #{tripNo}, #{placeName}, #{address}, #{orderNum}, #{startDate})
    </insert>

    <!-- 장소 순서와 시간 업데이트 -->
    <update id="updatePlaceOrderAndDate" parameterType="com.teamproject.myteam01.domain.TripPlaceVO">
        UPDATE trip_places
        SET order_num = #{orderNum}, start_date = #{startDate}
        WHERE id = #{id}
    </update>

</mapper>
