<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.teamproject.myteam01.mapper.FavoriteMapper">

    <!-- 즐겨찾기 목록 삽입 -->
    <insert id="insertFavoriteList" parameterType="com.teamproject.myteam01.domain.FavoriteListVO" useGeneratedKeys="true" keyProperty="listId">
	    INSERT INTO FAVORITELIST (USERID, LIST_NAME)
	    VALUES (#{userId}, #{listName})
	</insert>

    <!-- 즐겨찾기 항목 삽입 -->
    <insert id="insertFavoriteItem" parameterType="com.teamproject.myteam01.domain.FavoriteItemVO">
        INSERT INTO FAVORITES (FAVORITE_ID, LIST_ID, USERID, ITEM_NAME, LINK, ENO, FNO)
        VALUES (#{favoriteId}, #{listId}, #{userid}, #{itemName}, #{link}, #{eno}, #{fno})
    </insert>

    <!-- 사용자 ID로 즐겨찾기 목록 조회 -->
    <select id="getFavoriteListsByUserId" parameterType="String" resultType="com.teamproject.myteam01.domain.FavoriteListVO">
        SELECT LIST_ID, USERID, LIST_NAME
        FROM FAVORITELIST
        WHERE USERID = #{userid}
    </select>

    <!-- 즐겨찾기 목록 ID로 즐겨찾기 항목 조회 -->
    <select id="getFavoritesByListId" parameterType="Long" resultType="com.teamproject.myteam01.domain.FavoriteItemVO">
        SELECT FAVORITE_ID, USERID, ITEM_NAME, LINK, ENO, FNO
        FROM FAVORITES
        WHERE LIST_ID = #{listId}
    </select>

    <!-- 즐겨찾기 목록 이름 업데이트 -->
    <update id="updateFavoriteListName" parameterType="com.teamproject.myteam01.domain.FavoriteListVO">
        UPDATE FAVORITELIST
        SET LIST_NAME = #{listName}
        WHERE LIST_ID = #{listId}
    </update>

    <!-- 즐겨찾기 항목 삭제 -->
    <delete id="deleteFavoriteItem" parameterType="Long">
        DELETE FROM FAVORITES WHERE FAVORITE_ID = #{favoriteId}
    </delete>

    <!-- 즐겨찾기 항목과 관련된 음식점/행사 정보 조인 조회 -->
    <select id="getFavoriteDetails" parameterType="Long" resultMap="FavoriteDetailMap">
        SELECT f.FAVORITE_ID, f.ITEM_NAME, f.LINK, r.FNAME AS restaurantName, e.ENAME AS eventName
        FROM FAVORITES f
        LEFT JOIN RESTAURANTS r ON f.FNO = r.FNO
        LEFT JOIN EVENT e ON f.ENO = e.ENO
        WHERE f.FAVORITE_ID = #{favoriteId}
    </select>

    <!-- ResultMap 설정 -->
    <resultMap id="FavoriteDetailMap" type="com.teamproject.myteam01.domain.FavoriteItemVO">
        <result property="favoriteId" column="FAVORITE_ID"/>
        <result property="itemName" column="ITEM_NAME"/>
        <result property="link" column="LINK"/>
        <result property="fname" column="restaurantName"/>
        <result property="ename" column="eventName"/>
    </resultMap>

</mapper>